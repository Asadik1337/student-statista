<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Statista</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f6fb}
header{background:#1e88e5;color:#fff;padding:15px;text-align:center;font-size:20px;position:relative;}
.container{max-width:1200px;margin:20px auto;padding:10px}
.card{background:#fff;border-radius:8px;padding:15px;margin-bottom:12px}
button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer}
.primary{background:#1e88e5;color:white}
.secondary{background:#777;color:white}
.danger{background:#c62828;color:white}
.back{background:#555;color:white;margin-bottom:10px}
.green{color:#2e7d32;font-weight:bold}
.red{color:#c62828;font-weight:bold}
.stage{margin-left:0}
.lesson{margin-left:20px}
.hw{margin-left:40px}
img{max-width:120px;border-radius:6px;margin-top:6px}
input[type=file]{display:none}

/* ‚úÖ HELP BUTTON */
#helpBtn{
  position: absolute;
  top: 50%;
  right: 16px;
  transform: translateY(-50%);
  background: #ffffff;
  color: #1e88e5;
  border: 2px solid #1e88e5;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 13px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

#helpBtn:hover{
  background: #1e88e5;
  color: #ffffff;
}

</style>
</head>


<body>
<header>
  Statista
  <div id="helpBtn" onclick="openInstruction()">üìòInstructions
  </div>
</header>
  <div class="container" id="app"></div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyDJDVZazGiEUshVicJX8ObvxIjDPgA5rTo",
  authDomain: "studentstatista.firebaseapp.com",
  databaseURL: "https://studentstatista-default-rtdb.firebaseio.com",
  projectId: "studentstatista",
  storageBucket: "studentstatista.firebasestorage.app"
});
const db = firebase.database();
const storage = firebase.storage();

/* ================= GROUPS ================= */
const GROUPS = {
 "GROUP IELTS 9:00 M/W/F":[
  "HOSHIMOVA NILUFAR","JURAYEVA AZIZA","MAHMUDOV SUNNAT","MUHIDDINOVA MAHBUBA",
  "NORBOYEV SHOHJAXON","OCHILOV LOCHINBEK","ORALOVA SHOHINUR",
  "RAVSHANOVA ZAYNAB","TOSHPULATOV ABBOS"
 ],
 "GROUP IELTS 17:00 MWF":[
  "ABDURAHIMOVA ZILOLA","ALIMOV BEHRUZ","ANVAROVA RUXSHONA","ASADOV SARDOR",
  "BAXRONOVA FAYRUZA","GAFURJONOV ULUGBEK","ISMOILOV ISMOIL",
  "JULIBOYEVA ZEBO","KOZIMJONOVA DURDONA","MELIKUZIYEVA RUXSHONA",
  "NIGMATOV ABDURAHIM","RAHMATULLAYEV BEXRUZ","TALABOV SAUD",
  "XISLATULLAYEV JAVOXIR","XODJAYEVA LAZIZA","YORMATOV MIRABROR"
    ], 
 "GROUP CEFR 15:30 MWF":[
  "ABDUGAFFAROVA MANZURA","ISROILOV ISMOIL","JORABEKOV AZIZBEK","NORBOYEVA YULDUZ",
  "TULKUNOVA EZOZA","XURSANBEKOVA AZIZA","QUDRATILLA OMONOV","OCHILOV KAMRONBEK",
  "GUZOROV MAHMUDBEK","MANSUROV MUSTAFO"
 ],
 "GROUP IELTS T/T/S 9:00":[
  "SAIDUSMONOVA MADINA","SOBIROVA MARJONA","TILLAYEV OYBEK",
  "TOSHTEMIROVA MUBORAK","UMAROVA MOXIGUL"
 ],
 "GROUP IELTS 10:30 TTS":[
  "ADXAMOVA MUBINA","BAXTIYOROVA NILUFAR",
  "ISAMATOVA LAYLO","NOSIROVA LAZIZA","QILICHOVA GULISTON"
 ],
 "GROUP IELTS T/T/S 14:00":[
  "ABDUAZIZOVA HABIBA","ABDUJABBOROVA LOLA","ABDUVALIYEVA OMINA",
  "ALISHEROV NURMUHAMMAD","DJURAYEVA NURGUL","ISLOMBEKOVA EZOZA",
  "ISMAILOVA EZOZA","JORABEKOV AFZALBEK","MAHMUDJONOV FAYZULLOH",
  "MIRAHMEDOVA MUSLIMA","OLIMJONOVA DILNURA","TOJIBOYEV MUXAMMAD",
  "UROLOV SIROJ","XUDOYBERDIYEV QOSIMBEK"
 ],
 "GROUP IELTS 15:30 TTS":[
  "ABUBAKIROVA RAHIMA","IMANKULOVA CHAROS","ISLOMXOJAYEV YUNUS",
  "KAYUMKHAJAYEVA JASMINA","MAVLONBEKOV NURMUHAMMAD",
  "MIRAXMEDOVA ROBIYA","MIRSAIDOVA MALIKA","MIRSODIQOV MIRABROR",
  "QODIROV ABDUVALI","QOSIMOVA NARGIZA","RAVSHANOVA MUSLIMA",
  "SHARAXMEDOVA KAMILA","SHERALIYEV ELSHOD","TOGAYEVA SHAXINA",
  "UMARXONOVA JAVOHIRPOSHSHA","YOLDASHEVA FARZONA","ZOIRXOJAYEVA ROBIYA"
 ]
};

/* ================= STAGES ================= */
/* ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠–¢–û –°–ï–†–î–¶–ï –°–ò–°–¢–ï–ú–´ */
const STAGES = {
  "STAGE 1 - WRITING TASK 1": {
    "LESSON 1": [
      "Dictation 1-3",
      "Reading Test Bank Updated 1-3",
      "New Podcasts 1-4",
      "Writing Task 1 (3 graphs - introduction & overview)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Work or Study"
    ],
    "LESSON 2": [
      "Dictation 4-6",
      "Reading Test Bank Updated 4-6",
      "New Podcasts 5-8",
      "Writing Task 1 (Full report)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Hometown"
    ],
    "LESSON 3": [
      "Dictation 7-9",
      "Reading Test Bank Updated 7-9",
      "New Podcasts 9-12",
      "Writing Task 1 (Full report)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Home"
    ],
    "LESSON 4": [
      "Dictation 10-12",
      "Reading Test Bank Updated 10-12",
      "New Podcasts 13-16",
      "Writing Task 1 (Report 5-6 full)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Social Media"
    ],
    "LESSON 5": [
      "Dictation 13-15",
      "Reading Test Bank Updated 13-15",
      "New Podcasts 17-20",
      "Writing Task 1 (Report 7-8 full)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Colors"
    ],
    "LESSON 6": [
      "Dictation 16-18",
      "Reading Test Bank Updated 16-18",
      "New Podcasts 21-24",
      "Writing Task 1 (Full report)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Music"
    ],
    "LESSON 7": [
      "Dictation 19-21",
      "Reading Test Bank Updated 19-21",
      "New Podcasts 25-28",
      "Writing Task 1 (Full report)",
      "Vocabulary for Test Bank (Learn)",
      "Speaking: Food"
    ],
    "LESSON 8": [
      "Dictation 22-24",
      "Reading Test Bank Updated 22-24",
      "New Podcasts 29-32",
      "Vocabulary for Test Bank (Learn)",
      "Writing Report",
      "Speaking: Shopping"
    ],
    "LESSON 9": [
      "Dictation 25-27",
      "Reading Test Bank Updated 25-27",
      "New Podcasts 33-36",
      "Vocabulary for Test Bank (Learn)",
      "Writing Task 1",
      "Speaking: Sport"
    ]
  },

  "STAGE 2 - LISTENING": {
    "LESSON 1": [
      "Listening Strategies Unit 1",
      "Listening Practice Lesson 1",
      "Reading Practice Lesson 1",
      "Spelling Dictation (Pages 2-3)",
      "Task 1 Editing (Rewriting)",
      "Speaking: Shopping"
    ],
    "LESSON 2": [
      "Listening Strategies Unit 2",
      "Listening Practice Lesson 2",
      "Reading Practice Lesson 2",
      "Spelling Dictation (All pages)",
      "Listening Made Easy",
      "Task 1 (Rewriting)",
      "Speaking: Morning routine"
    ],
    "LESSON 3": [
      "Listening Strategies Unit 3",
      "Listening Practice Lesson 3",
      "Reading Practice Lesson 3",
      "Spelling Dictation",
      "Listening Made Easy",
      "Task 1 (Rewriting)",
      "Speaking: News"
    ],
    "LESSON 4": [
      "Listening Strategies Unit 4",
      "Listening Practice Lesson 4",
      "Reading Practice Lesson 4",
      "Spelling Dictation",
      "Listening Made Easy",
      "Task 1 (Rewriting)",
      "Speaking: Sharing things"
    ],
    "LESSON 5": [
      "Listening Strategies Unit 5",
      "Listening Practice Lesson 5",
      "Reading Practice Lesson 5",
      "Spelling Dictation"
    ]
  },

  "STAGE 3 - READING": {
    "LESSON 1": [
      "Cambridge 10 Test 1 (L/R) + deep analysis",
      "TED Radio Hour (Where Joy Hides?) Part 1",
      "Shadowing Video",
      "Articles"
    ],
    "LESSON 2": [
      "Cambridge 10 Test 2 (L/R) + deep analysis",
      "TED Radio Hour (Where Joy Hides?) Part 2",
      "Task 1 report review",
      "Articles"
    ],
    "LESSON 3": [
      "Cambridge 10 Test 3 (L/R) + deep analysis",
      "TED Radio Hour (Quiet) Part 1",
      "Shadowing Video",
      "Articles"
    ],
    "LESSON 4": [
      "Cambridge 10 Test 4 (L/R) + deep analysis",
      "TED Radio Hour (Quiet) Part 2",
      "Task 1 report review",
      "Articles"
    ],
    "LESSON 5": [
      "Cambridge 11 Test 1 (L/R) + deep analysis",
      "TED Radio Hour (The Food We Eat) Part 1",
      "Shadowing Video",
      "Articles"
    ],
    "LESSON 6": [
      "Cambridge 11 Test 2 (L/R) + deep analysis",
      "TED Radio Hour (The Food We Eat) Part 2",
      "Task 1 report review",
      "Articles"
    ],
    "LESSON 7": [
      "Cambridge 11 Test 3 (L/R) + deep analysis",
      "TED Radio Hour (The Five Senses) Part 1",
      "Shadowing Video",
      "Articles"
    ],
    "LESSON 8": [
      "Cambridge 11 Test 4 (L/R) + deep analysis",
      "TED Radio Hour (The Five Senses) Part 2",
      "Task 1 new report",
      "Articles"
    ],
    "LESSON 9": [
      "Cambridge 12 Test 1 (L/R) + deep analysis",
      "TED Radio Hour (The Power Of Design) Part 1",
      "Shadowing Video",
      "Articles"
    ],
    "LESSON 10": [
      "Cambridge 12 Test 2 (L/R) + deep analysis",
      "TED Radio Hour (The Power Of Design) Part 2",
      "Task 1 new report",
      "Articles"
    ]
  },

  "STAGE 4 - WRITING TASK 2 AND SPEAKING": {
    "LESSON 1": [
      "Cambridge 12 Test 3 (L/R) + deep analysis",
      "TED Radio Hour (Making Mistakes) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles"
    ],
    "LESSON 2": [
      "Cambridge 12 Test 4 (L/R) + deep analysis",
      "TED Radio Hour (Making Mistakes) Part 2",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Opinion Essay"
    ],
    "LESSON 3": [
      "Cambridge 13 Test 1 (L/R) + deep analysis",
      "TED Radio Hour (Rethinking School) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Discussion Essay"
    ],
    "LESSON 4": [
      "Cambridge 13 Test 2 (L/R) + deep analysis",
      "TED Radio Hour (Rethinking School) Part 2",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Advantages / Disadvantages Essay"
    ],
    "LESSON 5": [
      "Cambridge 13 Test 3 (L/R) + deep analysis",
      "TED Radio Hour (Overcoming)",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Issue Discussion Essay"
    ],
    "LESSON 6": [
      "Cambridge 13 Test 4 (L/R) + deep analysis",
      "TED Radio Hour (Networks) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Mixed / Direct Essays"
    ],
    "LESSON 7": [
      "Cambridge 14 Test 1 (L/R) + deep analysis",
      "TED Radio Hour (Networks) Part 2",
      "Speaking Part 2 + Part 3",
      "Articles",
      "Direct Essay"
    ],
    "LESSON 8": [
      "Cambridge 14 Test 2 (L/R/W) + deep analysis",
      "TED Radio Hour (From Curiosity To Discovery) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles"
    ],
    "LESSON 9": [
      "Cambridge 14 Test 3 (L/R/W) + deep analysis",
      "TED Radio Hour (From Curiosity To Discovery) Part 2",
      "Speaking Part 2 + Part 3",
      "Articles"
    ],
    "LESSON 10": [
      "Cambridge 14 Test 4 (L/R/W) + deep analysis",
      "TED Radio Hour (Comfort Zone) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles"
    ],
    "LESSON 11": [
      "Cambridge 15 Test 1 (L/R/W) + deep analysis",
      "TED Radio Hour (Comfort Zone) Part 2",
      "Speaking Part 2 + Part 3",
      "Articles"
    ],
    "LESSON 12": [
      "Cambridge 15 Test 2 (L/R/W) + deep analysis",
      "TED Radio Hour (Money Paradox) Part 1",
      "Speaking Part 2 + Part 3",
      "Articles"
    ]
  },

  "STAGE 5 - POLISHING SKILLS": {
    "LESSON 1": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 2": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ],
    "LESSON 3": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 4": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ],
    "LESSON 5": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 6": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ],
    "LESSON 7": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 8": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ],
    "LESSON 9": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 10": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ],
    "LESSON 11": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 1",
      "Speaking Practice"
    ],
    "LESSON 12": [
      "Full Listening x1",
      "Full Reading x1",
      "Article reading",
      "1 hour podcast",
      "Writing Task 2",
      "Speaking Practice"
    ]
  }
};

/* ================= APP ================= */
const app=document.getElementById("app");
function openInstruction(){
  app.innerHTML = `
    <button class="back" onclick="home()">Back</button>

    <h2>üìò Student-Friendly Instructions: How to Use the Website</h2>

    <div class="card">
      <b>Step 1</b><br>
      When you open the website, click <b>‚ÄúEnter as Student‚Äù</b>.
    </div>

    <div class="card">
      <b>Step 2</b><br>
      Find your <b>group</b> and click on it.  
      After that, find your <b>full name</b> in the list and click on it.
    </div>

    <div class="card">
      <b>Step 3</b><br>
      You will see <b>5 stages</b>.  
      Click the stage you are currently studying, then choose the <b>lesson</b> and the <b>homework</b> you need to submit.
    </div>

    <div class="card">
      <b>Step 4</b><br>
      Attach <b>at least one photo</b> of your homework and submit it.<br><br>
      ‚ö†Ô∏è <b>Without a photo, the homework will NOT be saved and will NOT be marked as ‚ÄúSubmitted‚Äù.</b>
    </div>

    <div class="card">
      <b>üìå Important Note</b><br>
      For <b>Speaking homework</b>:
      <ul>
        <li>Send your speaking to the group (as usual)</li>
        <li>Take a screenshot of it</li>
        <li>Upload the screenshot to the website</li>
      </ul>
    </div>

    <div class="card">
      <b>‚úÖ Final Reminder</b><br>
      After submitting, always check that the homework status shows <b>‚ÄúSubmitted‚Äù</b>.
    </div>
  `;
}

/* ================= HOME ================= */
function home(){
 app.innerHTML=`
  <div class="card"><button class="primary" onclick="enterStudent()">Enter as Student</button></div>
  <div class="card"><button class="primary" onclick="login()">Teacher / Assistant</button></div>
 `;
}

/* ================= STUDENT FLOW ================= */
function enterStudent(){
 let h=`<button class="back" onclick="home()">Back</button><h3>Select Group</h3>`;
 Object.keys(GROUPS).forEach(g=>{
  h+=`<div class="card"><button class="primary" onclick="selectStudent('${g}')">${g}</button></div>`;
 });
 app.innerHTML=h;
}

function selectStudent(group){
 let h=`<button class="back" onclick="enterStudent()">Back</button><h3>${group}</h3>`;
 GROUPS[group].forEach(s=>{
  h+=`<div class="card"><button class="primary" onclick="showStages('${group}','${s}')">${s}</button></div>`;
 });
 app.innerHTML=h;
}

function showStages(group,student){
 let h=`<button class="back" onclick="selectStudent('${group}')">Back</button><h3>${student}</h3>`;
 Object.keys(STAGES).forEach(stage=>{
  h+=`<div class="card stage"><button class="primary" onclick="showLessons('${group}','${student}','${stage}')">${stage}</button></div>`;
 });
 app.innerHTML=h;
}

function showLessons(group,student,stage){
 let h=`<button class="back" onclick="showStages('${group}','${student}')">Back</button><h3>${stage}</h3>`;
 Object.keys(STAGES[stage]).forEach(lesson=>{
  h+=`<div class="card lesson"><button class="secondary" onclick="showHomework('${group}','${student}','${stage}','${lesson}')">${lesson}</button></div>`;
 });
 app.innerHTML=h;
}

async function showHomework(group, student, stage, lesson){
  let h = `
    <button class="back"
      onclick="showLessons('${group}','${student}','${stage}')">Back</button>
    <h3>${stage} / ${lesson}</h3>
  `;

  for (const hw of STAGES[stage][lesson]) {
    const snap = await db
      .ref(`submissions/${group}/${student}/${stage}/${lesson}/${hw}`)
      .once("value");

    const d = snap.val();
    const submitted = d && Array.isArray(d.files) && d.files.length > 0;

    h += `
      <div class="card hw">
        <b>${hw}</b><br>
        <span class="${submitted ? 'green' : 'red'}">
          ${submitted ? 'Submitted' : 'Not submitted'}
        </span><br>
        ${
          submitted
            ? d.files.map(url =>
                `<img src="${url}" />`
              ).join("")
            : ''
        }
        <br>
        <label class="primary">
          Submit photo
          <input type="file" accept="image/*" multiple
            onchange="submitHW(this,'${group}','${student}','${stage}','${lesson}','${hw}')">
        </label>
      </div>
    `;
  }

  app.innerHTML = h;
}

function safe(v) {
  return v.replace(/[^a-zA-Z0-9_-]/g, "_");
}

async function submitHW(input, group, student, stage, lesson, hw) {
  const files = Array.from(input.files);
  if (files.length === 0) {
    alert("At least one photo is required.");
    return;
  }

  let uploadedUrls = [];

  for (const file of files) {
    const filePath =
      `submissions/${safe(group)}/${safe(student)}/${safe(stage)}/${safe(lesson)}/${safe(hw)}/${Date.now()}_${safe(file.name)}`;

    const ref = storage.ref(filePath);
    await ref.put(file);

    const url = await ref.getDownloadURL();
    uploadedUrls.push(url);
  }

  await db.ref(`submissions/${group}/${student}/${stage}/${lesson}/${hw}`).set({
    files: uploadedUrls,
    time: Date.now()
  });

  alert("Submitted successfully ‚úî");
}

/* ================= ADMIN ================= */
function login(){
 const u=prompt("Login");const p=prompt("Password");
 if((u==="Teacher1"&&p==="Admin1")||(u==="Assistant1"&&p==="Admin2")) admin();
 else alert("Wrong credentials");
}

function admin(){
 let h=`<button class="back" onclick="home()">Back</button><h3>Admin Panel</h3>`;
 Object.keys(GROUPS).forEach(g=>{
  h+=`<div class="card"><b>${g}</b><br>
   <button class="primary" onclick="adminGroup('${g}')">Open</button>
   <button class="danger" onclick="clearGroup('${g}')">Clear Group Files</button>
  </div>`;
 });
 app.innerHTML=h;
}

function adminGroup(group){
  let h = `
    <button class="back" onclick="admin()">Back</button>
    <h3>${group}</h3>
    <h4>Select Stage</h4>
  `;

  Object.keys(STAGES).forEach(stage=>{
    h += `
      <div class="card">
        <button class="primary"
          onclick="adminStageSelect('${group}','${stage}')">
          ${stage}
        </button>
      </div>
    `;
  });

  app.innerHTML = h;
}

  function adminStageSelect(group, stage){
  let h = `
    <button class="back" onclick="adminGroup('${group}')">Back</button>
    <h3>${group}</h3>
    <h4>${stage}</h4>
    <h4>Select Lesson</h4>
  `;

  Object.keys(STAGES[stage]).forEach(lesson=>{
    h += `
      <div class="card">
        <button class="secondary"
          onclick="adminLessonView('${group}','${stage}','${lesson}')">
          ${lesson}
        </button>
      </div>
    `;
  });

  app.innerHTML = h;
}

async function adminLessonView(group, stage, lesson){
  let h = `
    <button class="back"
      onclick="adminStageSelect('${group}','${stage}')">Back</button>

    <h3>${group}</h3>
    <h4>${stage} / ${lesson}</h4>

    <button class="secondary"
      onclick="exportLessonCSV('${group}','${stage}','${lesson}')">
      üì§ Export lesson to CSV
    </button>
  `;

  for (const student of GROUPS[group]) {
    h += `<div class="card"><b>${student}</b><br>`;

    for (const hw of STAGES[stage][lesson]) {
      const snap = await db
        .ref(`submissions/${group}/${student}/${stage}/${lesson}/${hw}`)
        .once("value");

      const d = snap.val();
      const ok = d && Array.isArray(d.files) && d.files.length > 0;

      h += `
        <div class="hw">
          ${
            ok
              ? `<span class="green">Yes ‚Äî ${hw}</span>`
              : `<span class="red">No ‚Äî ${hw}</span>`
          }
          ${
            ok
              ? d.files.map(url =>
                  `<a href="${url}" target="_blank">üì∑</a>`
                ).join(" ")
              : ''
          }
        </div>
      `;
    }

    h += `</div>`;
  }

  app.innerHTML = h;
}
  
function clearGroup(group){
 if(!confirm("Clear ALL files for this group?"))return;
 db.ref(`submissions/${group}`).remove().then(()=>alert("Cleared"));
}

async function exportLessonCSV(group, stage, lesson){
  const students = GROUPS[group];
  const homeworks = STAGES[stage][lesson];

  let csv = [];
  csv.push(["Student Name", ...homeworks].join(","));

  for (const student of students) {
    let row = [student];

    for (const hw of homeworks) {
      const snap = await db
        .ref(`submissions/${group}/${student}/${stage}/${lesson}/${hw}`)
        .once("value");

      const d = snap.val();
      const yesNo =
        d && Array.isArray(d.files) && d.files.length > 0
          ? "Yes"
          : "No";

      row.push(yesNo);
    }

    csv.push(row.join(","));
  }

  const blob = new Blob([csv.join("\n")], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `${group} - ${stage} - ${lesson}.csv`;
  a.click();

  URL.revokeObjectURL(url);
}

home();
</script>
</body>
</html>































